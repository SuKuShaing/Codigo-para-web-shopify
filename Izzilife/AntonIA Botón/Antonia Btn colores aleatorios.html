<div id="contenedor-btn-antonia">
	<a id="link-anto" href="https://izzilife.cl/pages/antonia" target="_blank">
		<div id="Sparks">
			<svg
				viewBox="0 0 24 24"
				fill="none"
				stroke="currentColor"
				stroke-width="2"
				stroke-linecap="round"
				stroke-linejoin="round"
			>
				<!-- Sparkle grande -->
				<path
					class="sparkle"
					d="M16 18a2 2 0 0 1 2 2a2 2 0 0 1 2 -2a2 2 0 0 1 -2 -2a2 2 0 0 1 -2 2z"
				/>

				<!-- Sparkle mediana -->
				<path
					class="sparkle"
					d="M16 6a2 2 0 0 1 2 2a2 2 0 0 1 2 -2a2 2 0 0 1 -2 -2a2 2 0 0 1 -2 2z"
				/>

				<!-- Sparkle pequeña -->
				<path
					class="sparkle"
					d="M9 18a6 6 0 0 1 6 -6a6 6 0 0 1 -6 -6a6 6 0 0 1 -6 6a6 6 0 0 1 6 6z"
				/>
			</svg>
		</div>
		<p id="texto-btn-antonia">Evaluación Nutricional Gratis aquí</p>
	</a>
</div>

<style>
	#contenedor-btn-antonia {
		display: flex;
		justify-content: center;
		align-items: center;
		margin: 0 auto;
		width: 100%;
	}

	#link-anto {
		display: flex;
		justify-content: center;
		align-items: center;
		gap: 10px;
		text-decoration: none;
		/* padding: 10px 20px; */
		/* border-radius: 5px; */
		/* box-shadow: 0px 4px 17px rgba(40, 40, 11, 0.1), 0px 15px 66px rgba(40, 40, 11, 0.19); */
		/* transition: background-color 0.3s ease; */
	}

	#texto-btn-antonia {
		font-size: 18px;
		font-weight: semibold;
		color: rgb(var(--color-foreground));
		text-decoration: none;
		transition: color 0.3s ease;
	}

	/* ******* */
	/* Sparkle */
	/* ******* */
	#Sparks {
		width: 30px;
		height: 30px;
		color: rgba(var(--color-button));
	}
	.sparkle {
		transform-origin: center;
		transform-box: fill-box;
		animation: twinkle 1.5s infinite alternate ease-in-out;
		transition: color 1.5s ease;
	}
	#link-anto:hover .sparkle:nth-child(3),
	.sparkle:nth-child(3) {
		animation-delay: 0s;
	}
	#link-anto:hover .sparkle:nth-child(2),
	.sparkle:nth-child(2) {
		animation-delay: 0.7s;
	}
	#link-anto:hover .sparkle:nth-child(1),
	.sparkle:nth-child(1) {
		animation-delay: 1.1s;
	}

	@keyframes twinkle {
		0% {
			transform: scale(1);
			opacity: 1;
			color: var(--sparkle-previal-color);
		}
		100% {
			transform: scale(1.4);
			opacity: 0.5;
			color: var(--sparkle-target-color);
		}
	}

	/* Al hacer hover sobre el contenedor del botón,
   se aplica la animación hoverSpin a cada sparkle */
	#link-anto:hover .sparkle {
		animation: hoverSpin 3s ease-in-out infinite;
	}

	/* Nueva animación que incluye giro para el estado hover */
	@keyframes hoverSpin {
		0% {
			transform: scale(1) rotate(0deg);
			opacity: 1;
			color: var(--sparkle-previal-color);
		}
		50% {
			transform: scale(1.4) rotate(360deg);
			opacity: 0.5;
		}
		100% {
			transform: scale(1) rotate(720deg);
			opacity: 1;
			color: var(--sparkle-target-color);
		}
	}
</style>

<script>
	// Obtén el valor de la variable CSS (se espera que sea una cadena del tipo "0, 250, 0")
	const colorButton =
		getComputedStyle(document.documentElement)
			.getPropertyValue("--color-button")
			.trim() || "0, 0, 250";

	// Divide la cadena en sus componentes y conviértelos a un número entre 0 y 1
	const [initR, initG, initB] = colorButton
		.split(",")
		.map((component) => parseFloat(component.trim()) / 256);

	// Inicializa las variables random con esos valores
	let randomRed = initR;
	let randomGreen = initG;
	let randomBlue = initB;

	/* Variables para los colores aleatorios
	let randomRed = Math.random();
	let randomGreen = Math.random();
	let randomBlue = Math.random();
	*/

	// función para actualizar los colores aleatorios suavemente, sí llega a 1 empieza a bajar hasta 0, sí llega a 0 empieza a subir hasta 1
	function updateRandomColors(ramdomColor, name) {
		// sí el ramdomColor es menor a 0.1, lo sube un 10% y sí es mayor a 0.9 lo baja un 10%
		if (ramdomColor <= 0.02) {
			ramdomColor += 0.05;
		} else if (ramdomColor >= 0.98) {
			ramdomColor -= 0.05;
		} else {
			// sí está entre 0.1 y 0.9, lo sube o baja aleatoriamente
			let randides = Math.random();
			if ((randides.toFixed(2) * 100) % 10 === 0) {
				// sí el número aleatorio es divisible por 10, sí es menos de 0.2 lo duplica, sí es mayor a 0.8 lo divide por 2, sí no lo aumenta un 50%
				if (ramdomColor < 0.2) {
					ramdomColor = ramdomColor * 2;
				} else if (ramdomColor > 0.8) {
					ramdomColor = ramdomColor / 2;
				} else {
					ramdomColor = ramdomColor * 1.5;
				}
			} else if (randides < 0.5) {
				ramdomColor -= 0.03;
			} else {
				ramdomColor += 0.03;
			}
		}

		// Guarda el nuevo valor en la variable correspondiente para tener el valor en la siguiente vez que se envíe
		if (name === "randomRed") {
			randomRed = ramdomColor;
		} else if (name === "randomGreen") {
			randomGreen = ramdomColor;
		} else if (name === "randomBlue") {
			randomBlue = ramdomColor;
		}

		return ramdomColor;
	}

	// Función para generar un color aleatorio en formato rgb()
	function randomColor() {
		const r = Math.floor(updateRandomColors(randomRed, "randomRed") * 256);
		const g = Math.floor(updateRandomColors(randomGreen, "randomGreen") * 256);
		const b = Math.floor(updateRandomColors(randomBlue, "randomBlue") * 256);
		console.log({ r, g, b });
		return `rgb(${r}, ${g}, ${b})`;
	}

	let colorAnterior = "rgba(var(--color-button))";

	// Cada 1500ms actualiza la variable CSS en el root
	setInterval(() => {
		let colorActual = randomColor();

		// color previo
		document.documentElement.style.setProperty(
			"--sparkle-previal-color",
			colorAnterior
		);
		// color de destino
		document.documentElement.style.setProperty(
			"--sparkle-target-color",
			colorActual
		);
		// Actualiza el color anterior para la próxima iteración
		colorAnterior = colorActual;
	}, 1500);
</script>
